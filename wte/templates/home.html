{% extends "base.html" %}

<!-- This is the user homepage. In other words, the landing page -->

{% block title %} Home {% endblock %}

{% block content %}
{% include 'dashboard/navbar.html' %}
<div class="main-with-sidebar">
  <div class="dashboard-container">
    <!-- Main Content -->
    <section class="main-content">
      <!-- Welcome Section -->
      <section class="welcome-section">
        <div class="container-fluid">
          <div class="row">
            <div class="col">
              <h3 class="display-4 header-font">Hi {{ user.first_name }}!</h3>
            </div>
          </div>
        </div>
      </section>

      <!-- Bottom Sections -->
      <section class="bottom-sections">
        <div class="container-fluid">
          <!-- Top row: 3 cards -->
          <div class="row mb-4">
            <!-- Card 1: Rewards -->
            <div class="col-md-4 mb-3 mb-md-0">
              <div class="card h-100">
                <div class="card-header card-header-gradient-1">
                  <h2 class="h5 mb-0">Rewards Earned This Month</h2>
                </div>
                <div class="card-body">
                  <!-- Rewards content will go here -->
                  {{ rewards_this_month }}
                </div>
              </div>
            </div>

            <!-- Card 2: placeholder / summary -->
            <div class="col-md-4 mb-3 mb-md-0">
              <div class="card h-100">
                <div class="card-header card-header-gradient-2">
                  <h2 class="h5 mb-0">Rewards Earned to Date</h2>
                </div>
                <div class="card-body">
                  <!-- Future stats or content -->
                  {{ rewards_to_date }}
                </div>
              </div>
            </div>

            <!-- Card 3: placeholder / community -->
            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header card-header-gradient-3">
                  <h2 class="h5 mb-0">Total Events Attended</h2>
                </div>
                <div class="card-body">
                  <!-- Future stats or content -->
                  {{ total_events_attended }}
                </div>
              </div>
            </div>
          </div>

          <!-- Bottom row: full-width events table -->
          <div class="row">
            <div class="events-attended-card col-12">
              <div class="card">
                <div class="card-header card-header-gradient-4 d-flex justify-content-between align-items-center">
                  <h2 class="h5 mb-0">Events Attended</h2>
                  <a class="add-event-container" href="{% url 'community' %}">
                    Add Event
                  </a>
                </div>
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-striped mb-0">
                      <thead>
                        <tr>
                          <th>Event Name</th>
                          <th>Event Date</th>
                          <th>Event Organizer</th>
                          <th>Points Awarded</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for event in user_events %}
                        <tr>
                          <td>{{ event.event_name }}</td>
                          <td>{{ event.event_date|date:"F j, Y" }}</td>
                          <td>{{ event.event_organizer }}</td>
                          <td>
                            {% if event.activity_type == "event_external" %}
                            8
                            {% else %}
                            10
                            {% endif %}
                          </td>
                        </tr>
                        {% empty %}
                        <tr>
                          <td colspan="4">No events yet.</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                    <!-- PAGINATION -->
                    <div class="d-flex justify-content-between align-items-center mt-3">
                      <div>
                        <!-- Page {{ user_events.number }} of {{ user_events.paginator.num_pages }} -->
                      </div>

                      <nav aria-label="Events pagination">
                        <ul class="pagination mb-0">
                          {% if user_events.has_previous %}
                          <li class="page-item">
                            <a class="page-link" href="?page={{ user_events.previous_page_number }}">Previous</a>
                          </li>
                          {% else %}
                          <li class="page-item disabled">
                            <span class="page-link">Previous</span>
                          </li>
                          {% endif %}

                          {% for num in user_events.paginator.page_range %}
                          {% if num == user_events.number %}
                          <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                          </li>
                          {% else %}
                          <li class="page-item">
                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                          </li>
                          {% endif %}
                          {% endfor %}

                          {% if user_events.has_next %}
                          <li class="page-item">
                            <a class="page-link" href="?page={{ user_events.next_page_number }}">Next</a>
                          </li>
                          {% else %}
                          <li class="page-item disabled">
                            <span class="page-link">Next</span>
                          </li>
                          {% endif %}
                        </ul>
                      </nav>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
  </div>
</div>
{% endblock %}